<!DOCTYPE html>
<html>
<head>
<!-- Load the Paper.js library -->
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/underscore.js"></script>
<script type="text/javascript" src="js/paper.js"></script>
<!-- Define inlined PaperScript associate it with myCanvas -->
<script type="text/paperscript" canvas="myCanvas">


$(document).ready(function() {
    $.ajax({
        type: "GET",
        async: false,
        url: "TEST.csv",
        dataType: "text",
        success: function(data) {drawGraph(data);}
     });
});


function drawGraph(allText) {
  var count = 0, incr = 3.0 * 100, lastPoint, baseValue;
  var path = new Path();
  path.strokeColor = 'black';

  var allTextLines = allText.split(/\r\n|\n/);
  _.each(allTextLines, function(value) {
     value = value * 100;
     if(count === 0) {
	   var start = new Point(100, value);
	   lastPoint = start;
	   baseValue = value;
	   path.moveTo(lastPoint);
     } else {
     	if(value > (baseValue + incr)) {
     	  baseValue = value;
          lastPoint = new Point(lastPoint.x + 50, baseValue);
          path.lineTo(lastPoint);
          lastPoint = new Point(lastPoint.x, value);
          path.lineTo(lastPoint);
        }
        else if(value < (baseValue - incr)) {
	      baseValue = value;
	      lastPoint = new Point(lastPoint.x + 50, baseValue);
	      path.lineTo(lastPoint);
	      lastPoint = new Point(lastPoint.x, value);
	      path.lineTo(lastPoint);
        }
        else if(value > baseValue && lastPoint.y < value) {
		  baseValue = value;
		  lastPoint = new Point(lastPoint.x, value);
		  path.lineTo(lastPoint);

        }
        else if(value < baseValue && lastPoint.y > value) {
          baseValue = value;
          lastPoint = new Point(lastPoint.x, value);
          path.lineTo(lastPoint);
        }


     }
    count++;
  });
};


</script>
</head>
<body>
    <canvas id="myCanvas" resize></canvas>
</body>
</html>